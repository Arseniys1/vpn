# üöÄ –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –∑–∞–ø—É—Å–∫—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

## –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- **Go 1.21+** - [—Å–∫–∞—á–∞—Ç—å](https://golang.org/dl/)
- **Docker & Docker Compose** - [—Å–∫–∞—á–∞—Ç—å](https://www.docker.com/get-started)
- **Telegram Bot Token** - –ø–æ–ª—É—á–∏—Ç—å —á–µ—Ä–µ–∑ [@BotFather](https://t.me/BotFather)

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1Ô∏è‚É£ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

–°–∫–æ–ø–∏—Ä—É–π—Ç–µ –ø—Ä–∏–º–µ—Ä –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:
```bash
cd backend
cp configs/config.example.yaml configs/config.yaml
```

–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ `configs/config.yaml`:
- `telegram.bot_token` - —Ç–æ–∫–µ–Ω –≤–∞—à–µ–≥–æ Telegram –±–æ—Ç–∞
- `xray.panels[0]` - –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–∞–Ω–µ–ª–∏ 3x-ui (URL, username, password)
- –ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –∏–∑–º–µ–Ω–∏—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

### 2Ô∏è‚É£ –ó–∞–ø—É—Å–∫ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã (PostgreSQL + RabbitMQ)

```bash
docker-compose up -d postgres rabbitmq
```

–î–æ–∂–¥–∏—Ç–µ—Å—å, –ø–æ–∫–∞ —Å–µ—Ä–≤–∏—Å—ã –∑–∞–ø—É—Å—Ç—è—Ç—Å—è (~30 —Å–µ–∫—É–Ω–¥). –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å:
```bash
docker-compose ps
```

### 3Ô∏è‚É£ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```bash
cd backend
go mod download
```

### 4Ô∏è‚É£ –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

**–í–∞—Ä–∏–∞–Ω—Ç –ê: –ß–µ—Ä–µ–∑ Makefile (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)**

–¢–µ—Ä–º–∏–Ω–∞–ª 1 - API —Å–µ—Ä–≤–µ—Ä:
```bash
make run-api
```

–¢–µ—Ä–º–∏–Ω–∞–ª 2 - Worker:
```bash
make run-worker
```

**–í–∞—Ä–∏–∞–Ω—Ç –ë: –ù–∞–ø—Ä—è–º—É—é —á–µ—Ä–µ–∑ Go**

–¢–µ—Ä–º–∏–Ω–∞–ª 1 - API —Å–µ—Ä–≤–µ—Ä:
```bash
APP_ENV=development go run ./cmd/api/main.go
```

–¢–µ—Ä–º–∏–Ω–∞–ª 2 - Worker:
```bash
APP_ENV=development go run ./cmd/worker/main.go
```

**–í–∞—Ä–∏–∞–Ω—Ç –í: –ß–µ—Ä–µ–∑ Docker Compose (production-like)**

```bash
docker-compose up --build
```

## –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã

### –ü—Ä–æ–≤–µ—Ä–∫–∞ health check:
```bash
curl http://localhost:8080/health
```

–î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å: `{"status":"ok"}`

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–ø–∏—Å–∫–∞ —Å–µ—Ä–≤–µ—Ä–æ–≤:
```bash
curl http://localhost:8080/api/v1/servers
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ API —Å –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–µ–π:
–ù—É–∂–µ–Ω –∑–∞–≥–æ–ª–æ–≤–æ–∫ `X-Telegram-Init-Data` –æ—Ç Telegram WebApp.

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
backend/
‚îú‚îÄ‚îÄ cmd/
‚îÇ   ‚îú‚îÄ‚îÄ api/          # API —Å–µ—Ä–≤–µ—Ä
‚îÇ   ‚îî‚îÄ‚îÄ worker/       # Worker –¥–ª—è —Ñ–æ–Ω–æ–≤—ã—Ö –∑–∞–¥–∞—á
‚îú‚îÄ‚îÄ internal/
‚îÇ   ‚îú‚îÄ‚îÄ config/       # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ database/     # –†–∞–±–æ—Ç–∞ —Å –ë–î
‚îÇ   ‚îú‚îÄ‚îÄ handlers/     # HTTP –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
‚îÇ   ‚îú‚îÄ‚îÄ middleware/   # Middleware (auth, logging)
‚îÇ   ‚îú‚îÄ‚îÄ models/       # –ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö (GORM)
‚îÇ   ‚îú‚îÄ‚îÄ queue/        # RabbitMQ
‚îÇ   ‚îî‚îÄ‚îÄ services/     # –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
‚îú‚îÄ‚îÄ configs/          # –§–∞–π–ª—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
‚îú‚îÄ‚îÄ docker-compose.yml
‚îú‚îÄ‚îÄ Dockerfile
‚îî‚îÄ‚îÄ Makefile
```

## –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –≤–º–µ—Å—Ç–æ –∫–æ–Ω—Ñ–∏–≥–∞:

```bash
export DB_HOST=postgres
export DB_USER=postgres
export DB_PASSWORD=secret
export DB_NAME=xrayvpn
export RABBITMQ_URL=amqp://guest:guest@rabbitmq:5672/
export TELEGRAM_BOT_TOKEN=your_bot_token
export APP_ENV=development
```

## –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### ‚ùå –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–µ –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ PostgreSQL –∑–∞–ø—É—â–µ–Ω:
```bash
docker-compose ps postgres
docker-compose logs postgres
```

### ‚ùå RabbitMQ –Ω–µ –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏:
```bash
docker-compose logs rabbitmq
```

–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ RabbitMQ: http://localhost:15672 (guest/guest)

### ‚ùå –û—à–∏–±–∫–∞ "connection refused"

–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã –∑–∞–ø—É—â–µ–Ω—ã:
```bash
docker-compose ps
```

### ‚ùå –ú–∏–≥—Ä–∞—Ü–∏–∏ –Ω–µ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è

–ú–∏–≥—Ä–∞—Ü–∏–∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ API. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏:
```bash
docker-compose logs api
```

## Production —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ (Docker Swarm)

1. **–°–±–æ—Ä–∫–∞ –æ–±—Ä–∞–∑–æ–≤:**
```bash
docker build -t xray-vpn-api:latest .
docker build -t xray-vpn-worker:latest .
```

2. **–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Swarm:**
```bash
docker swarm init
```

3. **–†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ:**
```bash
docker stack deploy -c docker-compose.yml xray-vpn
```

4. **–ü—Ä–æ–≤–µ—Ä–∫–∞:**
```bash
docker service ls
docker service ps xray-vpn_api
```

## –î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã Make

```bash
make help          # –ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ –∫–æ–º–∞–Ω–¥—ã
make build         # –°–æ–±—Ä–∞—Ç—å –±–∏–Ω–∞—Ä–Ω–∏–∫–∏
make run-api       # –ó–∞–ø—É—Å—Ç–∏—Ç—å API
make run-worker    # –ó–∞–ø—É—Å—Ç–∏—Ç—å worker
make docker-build  # –°–æ–±—Ä–∞—Ç—å Docker –æ–±—Ä–∞–∑—ã
make docker-up     # –ó–∞–ø—É—Å—Ç–∏—Ç—å Docker Compose
make docker-down   # –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å Docker Compose
make clean         # –û—á–∏—Å—Ç–∏—Ç—å –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ã
```

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. ‚úÖ –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é —Å –ø–∞–Ω–µ–ª—å—é 3x-ui
2. ‚úÖ –ù–∞—Å—Ç—Ä–æ–∏—Ç—å SSL/TLS –¥–ª—è production
3. ‚úÖ –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ (Prometheus/Grafana)
4. ‚úÖ –ù–∞—Å—Ç—Ä–æ–∏—Ç—å —Ä–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –ë–î
5. ‚úÖ –ù–∞—Å—Ç—Ä–æ–∏—Ç—å reverse proxy (nginx/traefik)

## –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:
- –õ–æ–≥–∏: `docker-compose logs -f`
- –°—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–∏—Å–æ–≤: `docker-compose ps`
- –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é: `cat configs/config.yaml`

